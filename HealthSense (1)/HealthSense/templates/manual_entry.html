{% extends 'base.html' %}

{% block content %}
<div class="row mb-4">
    <div class="col">
        <h1 class="mb-0">Manual Data Entry</h1>
        <p class="text-muted">Enter health data manually for processing</p>
    </div>
</div>

<div class="card mb-4">
    <div class="card-header">
        <h5 class="mb-0">
            <i class="fas fa-pen me-2"></i>
            Enter Health Metrics
        </h5>
    </div>
    <div class="card-body">
        {% if error %}
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <strong>Error:</strong> {{ error }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endif %}
        
        <form method="POST" action="{{ url_for('manual_entry') }}">
            <div class="row mb-3">
                <div class="col-md-6">
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="device_id" name="device_id" value="MANUAL" required>
                        <label for="device_id">Device ID</label>
                    </div>
                </div>
            </div>
            
            <div class="row mb-3">
                <div class="col-md-6">
                    <div class="form-floating mb-3">
                        <input type="number" class="form-control" id="glucose" name="glucose" placeholder="100" min="20" max="500" required>
                        <label for="glucose">Glucose (mg/dL)</label>
                        <div class="form-text">Normal range: 70-180 mg/dL</div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <label class="form-label">Blood Pressure (mmHg)</label>
                    <div class="row">
                        <div class="col-6">
                            <div class="form-floating mb-3">
                                <input type="number" class="form-control" id="bp_systolic" name="bp_systolic" placeholder="120" min="60" max="250" required>
                                <label for="bp_systolic">Systolic</label>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="form-floating mb-3">
                                <input type="number" class="form-control" id="bp_diastolic" name="bp_diastolic" placeholder="80" min="40" max="180" required>
                                <label for="bp_diastolic">Diastolic</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-text">Normal range: 90-140/60-90 mmHg</div>
                </div>
            </div>
            
            <div class="row mb-3">
                <div class="col-md-6">
                    <div class="form-floating mb-3">
                        <input type="number" class="form-control" id="spo2" name="spo2" placeholder="98" min="70" max="100" required>
                        <label for="spo2">SpOâ‚‚ (%)</label>
                        <div class="form-text">Normal range: 94-100%</div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="form-floating mb-3">
                        <input type="number" class="form-control" id="heart_rate" name="heart_rate" placeholder="75" min="30" max="220" required>
                        <label for="heart_rate">Heart Rate (BPM)</label>
                        <div class="form-text">Normal range: 50-100 BPM</div>
                    </div>
                </div>
            </div>
            
            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">Cancel</a>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save me-2"></i>
                    Submit Data
                </button>
            </div>
        </form>
    </div>
</div>

<div class="card mb-4">
    <div class="card-header">
        <h5 class="mb-0">
            <i class="fas fa-info-circle me-2"></i>
            About Manual Data Entry
        </h5>
    </div>
    <div class="card-body">
        <p>This form allows you to manually enter health data as if it were coming from a wearable device. After submission, the data will be:</p>
        <ul>
            <li>Processed by our system just like device data</li>
            <li>Analyzed by our ML models for health risk predictions</li>
            <li>Checked for any potential health alerts</li>
            <li>Displayed on the dashboard in real-time</li>
        </ul>
        <p>Use this feature when testing the system or when you want to input specific values to see how the system responds.</p>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Pre-fill form with reasonable defaults
        document.getElementById('glucose').value = '100';
        document.getElementById('bp_systolic').value = '120';
        document.getElementById('bp_diastolic').value = '80';
        document.getElementById('spo2').value = '98';
        document.getElementById('heart_rate').value = '75';
        
        // Add visual feedback for value ranges
        const inputs = ['glucose', 'bp_systolic', 'bp_diastolic', 'spo2', 'heart_rate'];
        const ranges = {
            'glucose': [70, 180],
            'bp_systolic': [90, 140],
            'bp_diastolic': [60, 90],
            'spo2': [94, 100],
            'heart_rate': [50, 100]
        };
        
        inputs.forEach(input => {
            const element = document.getElementById(input);
            element.addEventListener('input', function() {
                const value = parseFloat(this.value);
                const range = ranges[input];
                
                if (value < range[0] || value > range[1]) {
                    this.classList.add('is-invalid');
                    this.classList.remove('is-valid');
                } else {
                    this.classList.add('is-valid');
                    this.classList.remove('is-invalid');
                }
            });
            
            // Trigger input event to apply initial styling
            const event = new Event('input');
            element.dispatchEvent(event);
        });
    });
</script>
{% endblock %}